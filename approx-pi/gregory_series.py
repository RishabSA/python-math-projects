import math
from decimal import Decimal, getcontext

# The McLaurin Series for arctan(x) is:
# x - x^3/3 + x^5/5 - x^7/7 + x^9/9 - x^11/11 + ...
# Σ{i = 1}^{n_iter} (-1)^(i) x^(2i + 1)/(2i + 1)

# tan(45) = tan(π/4) = 1
# So, arctan(1) = π/4
# We can approximate arctan(1) * 4 to get our π approximation

# The Mclaurin Series for arctan(1) is:
# Σ{i = 1}^{n_iter} (-1)^(i)/(2i + 1)


def gregory_series(n_iter, n_places):
    getcontext().prec = 2 * n_places

    result = Decimal(0)
    numerator = Decimal(1)

    for i in range(1, n_iter * 2 + 1, 2):
        result += numerator / i
        numerator *= -1

    pi_approx = Decimal(4) * result

    # Round to exactly n_places
    getcontext().prec = n_places
    return +pi_approx


n_iter = 10**7

n_places = 1000
pi_approx = gregory_series(n_iter, n_places)

print(f"Gregory Series Pi Approximation: {pi_approx}")
print("\n\n")
print(f"Absolute Error: {abs(pi_approx - Decimal(math.pi))}")
print("\n\n")

"""
Gregory Series Pi Approximation: 3.141592553589793238462893383279502881072169399375201133474944586897660156286702367768659759356643435181816115138767628987159610907798749437564162519932154262921840525685738911188936864497956722060183084069066875260965526646043090687119185080323711542974449102968449594047066672473407390764383744468076265760145238753655698916426986840774092599643625761130798696094641617217265402226076824494660815241203296860850478907363071477094747222272175234788693268091435389432878545694416427358471967612168166004826205453145751143767305740353776445180369897832541645202663093216410460082487090090215687035881467669197464560235506249442646634798516903008158365132938281087922136408160557260639435132286098567968459083503971398487924729782166156728813912670003705192668361903404073289522138987705101128518863978217387329475368110184848928513354064097302444242040172848409660075977081115165901433978902338263318259526080326515588638722498275823728307171176716841262244313883515512865288985230263678031163996509609

Absolute Error: 9.9999999877535070085264682280518406772499798866525055413102339843713297632231340240643356564818183884861232371012840389092201250562435837480067845737078159474314261088811063135502043277939816915930933124739034473353956909312880814919676288457025550897031550405952933327526592609235616255531923734239854761246344301083573013159225907400356374238869201303905358382782734597773923175505339184758796703139149521092636928522905252777727824765211306731908564610567121454305583572641528032387831833995173794546854248856232694259646223554819630102167458354797336906783589539917512909909784312964118532330802535439764493750557353365201483096991841634867061718912077863591839442739360564867713901432031540916496028601512075270217833843271186087329996294807331638096595926710477861012294898871481136021782612670524631889815151071486645935902697555757959827151590339924022918884834098566021097661736681740473919673484411361277501724176271692828823283158737755686116484487134711014769736321968836003490391E-8
"""
